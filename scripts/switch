HOST_FILE="$HOME/.nix_host"
host=${1:-$(cat "$HOST_FILE" 2>/dev/null)}

if [[ ! -z "$1" ]]; then
  host=$1
  echo "Setting $1 as host"
  echo "$host" > "$HOST_FILE"
fi

if [[ -z "$host" ]]; then
  read 'Set default host: ' host || return 1
  echo "$host" > "$HOST_FILE"
fi

cd ~/nixos
echo "Updating host: $host"
sudo nix flake update
sudo nixos-rebuild switch --flake ".#$host" --no-reexec && \
notify-send "Update successful." || notify-send "Update failed."


